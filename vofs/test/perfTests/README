This is a test to compare accessing FITS files through the following means:
- local attached volume or directory
- vmount (sshfs mount) to cavern vospace Web service
- mountvofs to CADC vospace Web service

To run the tests use the following command from a host running docker (host in this case is CentOS 7.0. For other hosts, the command might be slightly different):
docker run --rm --cap-add SYS_ADMIN --device /dev/fuse --mount type=bind,source="$A",target=/admin --mount type=bind,source=/mnt/data/CADCRegtest1/,target=/data bucket.canfar.net/vmount-test -i=1 -f=fitsverify


Where:
--rm: remove container after exit.

--cap-add SYS_ADMIN --device /dev/fuse: required to do the vmount and mountvofs FUSE based mounts in the container

--mount type=bind,source="$A",target=/admin: maps to a directory on the local host ($A - admin) where the CADCRegtest1 pwd and certificates are stored ($A/etc/cadcregtest1.pass and $A/test-certificates/x509_CADCRegtest1.pem

--mount type=bind,source=/mnt/data/CADCRegtest1/,target=/data: local mount (directory) to compare against in the test. It is expected to have the same files and directory structure found in vos:CADCRegtest1/vmount-perf-test

bucket.canfar.net/vmount-test: name of the image

-i=<>: number of instances to test with (1-10)

-f=<>: function to test. Values: fitsverify, gzip, gunzip

Note: To make changes to the run.sh test script without rebuilding the image, simply copy or create a new run.sh script and map the location of the directory on the host to the /app directory in the container. For example, if run.sh is in the current directory on the host, add the following to the docker run command: 
--mount type=bind,source="$(pwd)",target=/app

Running times are displayed on the output lines prefixed with *** and are in seconds.

To build a new image, run the following command in the current directory:
docker build -t bucket.canfar.net/vmount-test .

To push the image to the bucket repo, first login
docker login bucket.canfar.net

and then do
docker push bucket.canfar.net/vmount-test
